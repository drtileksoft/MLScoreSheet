<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:controls="clr-namespace:MLScoreSheetCounter.Controls"
             x:Class="MLScoreSheetCounter.MainPage"
             Padding="16">

    <Grid RowSpacing="12" ColumnSpacing="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <!-- Photo actions -->
            <RowDefinition Height="Auto" />
            <!-- Overlay toggle -->
            <RowDefinition Height="Auto" />
            <!-- Calculation threshold -->
            <RowDefinition Height="Auto" />
            <!-- Visibility threshold -->
            <RowDefinition Height="Auto" />
            <!-- Result -->
            <RowDefinition Height="Auto" />
            <!-- Processing row -->
            <RowDefinition Height="*"   />
            <!-- Preview -->
            <RowDefinition Height="Auto" />
            <!-- Save -->
        </Grid.RowDefinitions>

        <!-- Row 0: Photo actions (two stacked buttons via 2-row Grid) -->
        <Grid Grid.Row="0" RowSpacing="8">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <Button x:Name="PickPhotoButton"
                    Grid.Row="0"
                    Text="Pick photo from gallery"
                    Clicked="OnPickPhoto"
                    SemanticProperties.Description="Pick a photo from the device gallery" />

            <Button x:Name="TakePhotoButton"
                    Grid.Row="1"
                    Text="Take photo"
                    Clicked="OnTakePhoto"
                    SemanticProperties.Description="Capture a photo with the camera" />
        </Grid>

        <!-- Row 1: Overlay toggle -->
        <Grid Grid.Row="1" ColumnSpacing="8" VerticalOptions="Center">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <CheckBox x:Name="OverlayCheckBox"
                      Grid.Column="0"
                      IsChecked="True"
                      VerticalOptions="Center"
                      SemanticProperties.Description="Show detection overlay on the image" />

            <Label Grid.Column="1"
                   Text="Show results in overlay"
                   VerticalTextAlignment="Center" />
        </Grid>

        <!-- Row 2: Calculation threshold: Label | Slider (star) | Value (fixed) -->
        <Grid Grid.Row="2" ColumnSpacing="8" VerticalOptions="Center">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <!-- Slider grows by star sizing -->
                <ColumnDefinition Width="60" />
                <!-- Fixed width for value -->
            </Grid.ColumnDefinitions>

            <Label Grid.Column="0"
                   Text="Ink fill threshold"
                   VerticalTextAlignment="Center" />

            <Slider x:Name="CalculationTresholdSlider"
                    Grid.Column="1"
                    Minimum="0"
                    Maximum="1"
                    Value="0.3"
                    ValueChanged="OnCalculationThresholdChanged"
                    SemanticProperties.Description="Adjust the calculation threshold for Box fill sensitivity" />

            <Label x:Name="CalculationThresholdValueLabel"
                   Grid.Column="2"
                   Text="0.30"
                   HorizontalTextAlignment="End"
                   VerticalTextAlignment="Center" />
        </Grid>

        <!-- Row 3: Visibility threshold: Label | Slider (star) | Value (fixed) -->
        <Grid Grid.Row="3" ColumnSpacing="8" VerticalOptions="Center">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <!-- Slider grows by star sizing -->
                <ColumnDefinition Width="60" />
            </Grid.ColumnDefinitions>

            <Label Grid.Column="0"
                   Text="Details Ink fill threshold"
                   VerticalTextAlignment="Center" />

            <Slider x:Name="VisibilityTresholdSlider"
                    Grid.Column="1"
                    Minimum="0"
                    Maximum="1"
                    Value="0.3"
                    ValueChanged="OnVisibilityThresholdChanged"
                    SemanticProperties.Description="Adjust the debug overlay visibility threshold" />

            <Label x:Name="VisibilityThresholdValueLabel"
                   Grid.Column="2"
                   Text="0.30"
                   HorizontalTextAlignment="End"
                   VerticalTextAlignment="Center" />
        </Grid>

        <!-- Row 4: Result -->
        <Label x:Name="ResultLabel"
               Grid.Row="4"
               Text="TOTAL = ?"
               FontSize="18"
               FontAttributes="Bold"
               SemanticProperties.HeadingLevel="Level2" />

        <!-- Row 5: Processing row: Spinner | Text -->
        <Grid x:Name="ProcessingContainer"
              Grid.Row="5"
              ColumnSpacing="8"
              IsVisible="False"
              VerticalOptions="Center">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <ActivityIndicator x:Name="ProcessingIndicator"
                               Grid.Column="0"
                               IsRunning="False"
                               VerticalOptions="Center" />
            <Label x:Name="ProcessingLabel"
                   Grid.Column="1"
                   Text="Processing..."
                   VerticalTextAlignment="Center" />
        </Grid>

        <!-- Row 6: Preview (fills the remaining space thanks to RowDefinition "*") -->
        <Grid Grid.Row="6">
            <ContentView x:Name="PreviewPlaceholder"
                         Padding="24"
                         BackgroundColor="#111"
                         HorizontalOptions="Fill"
                         VerticalOptions="Fill">
                <Label Text="Place the score sheet on a flat, well-lit surface. Hold the camera directly above it so the entire sheet is visible and free of shadows."
                       TextColor="#fff"
                       FontSize="16"
                       HorizontalTextAlignment="Center"
                       VerticalTextAlignment="Center" />
            </ContentView>

            <controls:PanPinchContainer x:Name="PreviewContainer"
                                        IsVisible="False"
                                        BackgroundColor="#111"
                                        VerticalOptions="Fill"
                                        HorizontalOptions="Fill">
                <Image x:Name="Preview"
                       Aspect="AspectFit"
                       VerticalOptions="Center"
                       HorizontalOptions="Center"
                       AutomationProperties.IsInAccessibleTree="True"
                       SemanticProperties.Description="Preview of the selected photo with pan and zoom" />
            </controls:PanPinchContainer>
        </Grid>

        <!-- Row 7: Save -->
        <Button x:Name="SaveToGalleryButton"
                Grid.Row="7"
                Text="Save to gallery"
                IsEnabled="False"
                Clicked="OnSaveToGalleryClicked"
                SemanticProperties.Description="Save the current preview to gallery" />
    </Grid>
</ContentPage>
